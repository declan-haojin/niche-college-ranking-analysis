---
title: "College Ranking Predictions"
subtitle: "Report"
format: pdf
editor: visual
execute:
  echo: false
message: false
warning: false
editor_options: 
  chunk_output_type: inline
---

```{r}
#| label: load-pkgs
#| message: false

library(tidyverse)
library(corrplot)
library(tidymodels)
library(scales)
library(ggthemes)
library(gridExtra)

```

# Introduction

## Research Background

Every year, millions of students apply to colleges across the United States, and many of them use college rankings lists from sources such as *US News and World Report*, Forbes.com, and Niche.com to to help them decide where to apply and where to go. In recent years, these lists have been heavily criticized for focusing on "exclusivity and resources, rather than accessibility and economic mobility" (1).The system can also be easily manipulated by a university if that university prioritize certain metrics to raise their rankings, as seen in Northeastern University meteoric rise from #163 to #49 on the US News and World Report list in only 17 years. The president of Northeastern University even explicitly stated that it was a top priority of the university to raise its ranking (2).

\(1\) https://thehill.com/changing-america/enrichment/education/3641004-the-scandal-facing-college-ranking-lists-explained/

\(2\) https://www.bostonmagazine.com/news/2014/08/26/how-northeastern-gamed-the-college-rankings/

These lists are important because students applying to college trust these rankings and weigh them into their college decisions. Due to the large impact that a college has on a student's life, it is important to know where these rankings come from and what they actually measure. In this project, we will explore how influential different metrics are in determining a college's ranking.

In general, we want to examine how different variables affect a school's ranking on the **Niche College Ranking List** and determine which are most important to a high ranking. We plan to look at variables that are typically thought to influence school rank such as average SAT score and admission rate, but we also want to look at variables that aren't typically thought of such as geographic region or endowment size.

For the sake of clarity, when we say a "low rank," we are referring to schools with a lower numerical rank, such as #1 and #2. When we say a "high rank," we a referring to schools with a high numerical rank, such as #499 and #500.

## Data

```{r}
#| label: import

niche_data_500 <- read_csv("data/niche_data_500.csv")
us_dep_of_ed <- read_csv("data/us_dep_of_ed.csv", na = c("NULL", "PrivacySuppressed"))
```

**Data Set #1: Niche**

-   The first data set comes from Niche's "2023 Best Colleges in America" list

-   Niche aggregates data from a variety of sources, including the US Department of Education and reviews from students and alumni, to build their list of college rankings. The rankings list is updated monthly. However, Niche only receives data from the US Department of Education on an annual basis. The Niche data was scraped by Maia on October 17-19 2022.

-   There are `r nrow(niche_data_500)` observations, representing the top 500 schools in the United States. Each observation has two variables: `college` (institution name) and `rank`.

**Data Set #2: US Department of Education**

-   The second data set comes from the US Department of Education's College Scorecard, which is an exhaustive summary of characteristics and statistics for all colleges and universities in the United States.

-   The College Scorecard is updated by the Education Department as it collects new data, but most of the data comes from the 2020-2021 school year. Data used in the scorecard comes comes from data reported by the institutions, data on federal financial aid, data from taxes, and data from other federal agencies.

-   There were 2,989 variables in the original data set, many of which we don't need to answer our question, and since this data set was too large to load into RStudio, we used Excel to narrow this to 31 variables. We chose any variables that we thought would have an impact on college rank, and excluded redundant ones like specific breaksdowns of test scores. There are `r nrow(us_dep_of_ed)` observations in the data set, representing all of the colleges and universities in the United States.

#### Variable Summary

Here is a summary of the variables we will be using in our analysis. We selected every one we thought could impact rank, but left some out, such as test score breakdowns, to avoid redundancy.

Categorical:

-   `college`: Institution name
-   `REGION:` US geographic region (New England, Mid East, Great Lakes, Plains, Southeast, Southwest, Rocky Mountains, Far West, Outlying Areas)
-   `ACCREDAGENCY`: Accreditor for Institution
-   `CONTROL`: Public, Private nonprofit, or Private for-profit
-   `CCBASIC`: Carnegie Classification (basic)

Numerical

-   `ADM_RATE`: Admission rate
-   `UGDS`, `UGDS_WHITE`, `UGDS_BLACK`, `UGDS_HISP`, `UGDS_ASIAN`, `UGDS_AIAN`, `UGDS_NHPI`, `UGDS_2MOR`, and `UGDS_UNKN` represent the enrollment of undergraduate certificate/degree-seeking students, enrollment of undergraduate certificate/degree-seeking students who are White, Black, Hispanic, Asian, American Indian/Alaska Native, Native Hawaiian/Pacific Islander, two or more races, and of unknown race, respectively.
-   `NPT4_PUB`: Average net price for Title IV institutions (public institutions)
-   `NPT4_PRIV`: Average net price for Title IV institutions (private for-profit and nonprofit institutions)
-   `COSTT4_A`: Average cost of attendance (academic year institutions)
-   `COSTT4_P`: Average cost of attendance (program-year institutions)
-   `AVGFACSAL`: Average faculty salary
-   `PCTPELL`: Percentage of undergraduates who receive a Pell Grant
-   `C150_4`: Completion rate for first-time, full-time students at four-year institutions (150% of expected time to completion)
-   `AGE_ENTRY`: Average age of entry
-   `FEMALE`: Share of female students
-   `MARRIED`: Share of married students
-   `FIRST_GEN`: Share of first-generation students
-   `FAMINC`: Average family income
-   `MD_FAMINC`: Median family income
-   `ENDOWBEGIN`: Value of school's endowment at the beginning of the fiscal year
-   `SAT_AVG`: Average SAT equivalent score of students admitted
-   `ACTCMMID`: Midpoint of the ACT cumulative score

### Data Preparation

1.  To get the data, we scraped from Niche.com and downloaded data from the US Department of Education, and imported. The steps were done in an R script titled `niche-scrape.R`
2.  Some of the college names were slightly different between datasets, so we had to individually change names in the Department of Education dataset to match those in the Niche one before joining the two. The Observations for `University of South Florida - Sarasota-Manatee` (ranked 141) and `University of South Florida - St. Petersburg` (ranked 181) have been dropped from the `colleges` data set because they do not exist in the `us_dep_of_ed` dataset. This is because these two universities were combined with the main University of South Florida campus. Therefore the joined `colleges` data set only has 498 observations.

```{r}
#| label: fix-college-names

us_dep_of_ed <- us_dep_of_ed |>
  mutate(
    INSTNM = case_when(
      INSTNM == "Columbia University in the City of New York" ~
        "Columbia University",

      INSTNM == "Washington University in St Louis" ~
        "Washington University in St. Louis",

      INSTNM == "University of California-Los Angeles" ~
        "University of California - Los Angeles",

      INSTNM == "University of Michigan-Ann Arbor" ~
        "University of Michigan - Ann Arbor",

      INSTNM == "Georgia Institute of Technology-Main Campus" ~
        "Georgia Institute of Technology",

      INSTNM == "University of Virginia-Main Campus" ~
        "University of Virginia",

      INSTNM == "United States Military Academy" ~
        "United States Military Academy at West Point",

      INSTNM == "The University of Texas at Austin" ~
        "University of Texas - Austin",

      INSTNM == "University of California-Berkeley" ~
        "University of California - Berkeley",

      INSTNM == "University of California-Irvine" ~
        "University of California - Irvine",

      INSTNM == "University of California-San Diego" ~
        "University of California - San Diego",

      INSTNM == "University of California-Davis" ~
        "University of California - Davis",

      INSTNM == "University of California-Santa Barbara" ~
        "University of California - Santa Barbara",

      INSTNM == "University of California-Santa Cruz" ~
        "University of California - Santa Cruz",

      INSTNM == "University of California-Riverside" ~
        "University of California - Riverside",

      INSTNM == "University of North Carolina Wilmington" ~
        "University of North Carolina - Wilmington",

      INSTNM == "University of North Carolina at Greensboro" ~
        "University of North Carolina - Greensboro",

      INSTNM == "Albany College of Pharmacy and Health Sciences" ~
        "Albany College of Pharmacy & Health Sciences",

      INSTNM == "Arizona State University Campus Immersion" ~
        "Arizona State University",

      INSTNM == "Arizona State University-Downtown Phoenix" ~
        "Arizona State University - Downtown Phoenix Campus",

      INSTNM == "Augustana College" ~
        "Augustana College - Illinois",

      UNITID == "173160" ~
        "Bethel University - Minnesota",

      INSTNM == "Binghamton University" ~
        "Binghamton University, SUNY",

      INSTNM == "Bowling Green State University-Main Campus" ~
        "Bowling Green State University",

      INSTNM == "California Polytechnic State University-San Luis Obispo" ~
        "California Polytechnic State University (Cal Poly) - San Luis Obispo",

      INSTNM == "California State University-Fullerton" ~
        "California State University - Fullerton",

      INSTNM == "California State University-Long Beach" ~
        "California State University - Long Beach",

      INSTNM == "The College of Wooster" ~
        "College of Wooster",

      INSTNM == "Colorado State University-Fort Collins" ~
        "Colorado State University",

      INSTNM == "Concordia University-Wisconsin" ~
        "Concordia University - Wisconsin",

      INSTNM == "CUNY Bernard M Baruch College" ~
        "CUNY Baruch College",

      INSTNM == "CUNY City College" ~
        "CUNY City College of New York",

      INSTNM == "D'Youville College" ~
        "D'Youville",

      INSTNM == "Eastern New Mexico University-Main Campus" ~
        "Eastern New Mexico University",

      INSTNM == "Embry-Riddle Aeronautical University-Daytona Beach" ~
        "Embry-Riddle Aeronautical University - Daytona Beach",

      INSTNM == "Embry-Riddle Aeronautical University-Worldwide" ~
        "Embry-Riddle Aeronautical University - Worldwide",

      INSTNM == "Florida Agricultural and Mechanical University" ~
        "Florida A&M University",

      INSTNM == "Franklin and Marshall College" ~
        "Franklin & Marshall College",

      INSTNM == "Hobart William Smith Colleges" ~
        "Hobart and William Smith Colleges",

      INSTNM == "Indiana University-Bloomington" ~
        "Indiana University - Bloomington",

      INSTNM == "Indiana University-East" ~
        "Indiana University - East",

      INSTNM == "Indiana University-Purdue University-Indianapolis" ~
        "Indiana University-Purdue University - Indianapolis (IUPUI)",

      INSTNM == "Indiana Wesleyan University-Marion" ~
        "Indiana Wesleyan University",

      INSTNM == "Keiser University-Ft Lauderdale" ~
        "Keiser University - Fort Lauderdale",

      INSTNM == "Kent State University at Kent" ~
        "Kent State University",

      INSTNM == "Louisiana State University and Agricultural & Mechanical College" ~
        "Louisiana State University",

      UNITID == "151786" ~
        "Marian University Indianapolis",

      INSTNM == "Maryville University of Saint Louis" ~
        "Maryville University",

      INSTNM == "Metropolitan State University" ~
        "Metropolitan State University - Minnesota",

      INSTNM == "Miami University-Oxford" ~
        "Miami University",

      INSTNM == "Minnesota State University-Mankato" ~
        "Minnesota State University, Mankato",

      INSTNM == "Molloy College" ~
        "Molloy University",

      INSTNM == "Monroe College" ~
        "Monroe College - Bronx/New Rochelle",

      INSTNM == "Mount Saint Mary's University" ~
        "Mount Saint Mary's University Los Angeles",

      INSTNM == "New Mexico State University-Main Campus" ~
        "New Mexico State University",

      INSTNM == "New Mexico Institute of Mining and Technology" ~
        "New Mexico Tech",

      INSTNM == "North Carolina State University at Raleigh" ~
        "North Carolina State University",

      INSTNM == "North Dakota State University-Main Campus" ~
        "North Dakota State University",

      UNITID ==  "154101" ~
        "Northwestern College - Iowa",

      INSTNM == "Ohio University-Main Campus" ~
        "Ohio University",

      INSTNM == "Oklahoma State University-Main Campus" ~
        "Oklahoma State University",

      INSTNM == "Pacific University" ~
        "Pacific University Oregon",

      INSTNM == "The Pennsylvania State University" ~
        "Penn State",

      INSTNM == "Pennsylvania State University-Penn State Fayette- Eberly" ~
        "Penn State Fayette, The Eberly Campus",

      INSTNM == "Pennsylvania State University-Penn State York" ~
        "Penn State York",

      INSTNM == "Purdue University-Main Campus" ~
        "Purdue University",

      INSTNM == "Rutgers University-New Brunswick" ~
        "Rutgers University - New Brunswick",

      INSTNM == "Rutgers University-Newark" ~
        "Rutgers University - Newark",

      INSTNM == "The University of the South" ~
        "Sewanee - The University of the South",

      INSTNM == "South Dakota School of Mines and Technology" ~
        "South Dakota School of Mines & Technology",

      INSTNM == "St Bonaventure University" ~
        "St. Bonaventure University",

      INSTNM == "Saint John Fisher College" ~
        "St. John Fisher University",

      INSTNM == "St. Joseph's University-New York" ~
        "St. Joseph's University - New York",

      INSTNM == "St Lawrence University" ~
        "St. Lawrence University",

      INSTNM == "St Olaf College" ~
        "St. Olaf College",

      INSTNM == "Stanbridge University" ~
        "Stanbridge University - Orange County",

      INSTNM == "Stephen F Austin State University" ~
        "Stephen F. Austin State University",

      INSTNM == "Stony Brook University" ~
        "Stony Brook University, SUNY",

      INSTNM == "SUNY College of Environmental Science and Forestry" ~
        "SUNY College of Environmental Science & Forestry",

      INSTNM == "Farmingdale State College" ~
        "SUNY Farmingdale State College",

      INSTNM == "State University of New York at New Paltz" ~
        "SUNY New Paltz",

      INSTNM == "Texas A & M University-College Station" ~
        "Texas A&M University",

      INSTNM == "American Musical and Dramatic Academy" ~
        "The American Musical and Dramatic Academy (AMDA) - New York",

      INSTNM == "The College of Saint Scholastica" ~
        "The College of St. Scholastica",

      INSTNM == "Cooper Union for the Advancement of Science and Art" ~
        "The Cooper Union for the Advancement of Science and Art",

      INSTNM == "The Master's University and Seminary" ~
        "The Master's University",

      INSTNM == "Ohio State University-Main Campus" ~
        "The Ohio State University",

      INSTNM == "University of Alabama in Huntsville" ~
        "The University of Alabama in Huntsville",

      INSTNM == "University of Baltimore" ~
        "The University of Baltimore",

      INSTNM == "University of Tulsa" ~
        "The University of Tulsa",

      INSTNM == "University of Virginia's College at Wise" ~
        "The University of Virginia's College at Wise",

      INSTNM == "Trinity College" ~
        "Trinity College - Connecticut",

      INSTNM == "Tulane University of Louisiana" ~
        "Tulane University",

      UNITID == "196866" ~
        "Union College - New York",

      INSTNM == "University at Buffalo" ~
        "University at Buffalo, SUNY",

      INSTNM == "University of Alabama at Birmingham" ~
        "University of Alabama - Birmingham",

      INSTNM == "University of Cincinnati-Main Campus" ~
        "University of Cincinnati",

      INSTNM == "University of Colorado Denver/Anschutz Medical Campus" ~
        "University of Colorado Denver",

      INSTNM == "University of Maryland-College Park" ~
        "University of Maryland - College Park",

      INSTNM == "University of Maryland-Baltimore County" ~
        "University of Maryland, Baltimore County",

      INSTNM == "University of Massachusetts-Amherst" ~
        "University of Massachusetts - Amherst",

      INSTNM == "University of Massachusetts-Lowell" ~
        "University of Massachusetts Lowell",

      INSTNM == "University of Michigan-Dearborn" ~
        "University of Michigan - Dearborn",

      INSTNM == "University of Minnesota-Crookston" ~
        "University of Minnesota Crookston",

      INSTNM == "University of Minnesota-Duluth" ~
        "University of Minnesota Duluth",

      INSTNM == "University of Minnesota-Twin Cities" ~
        "University of Minnesota Twin Cities",

      INSTNM == "University of Missouri-Columbia" ~
        "University of Missouri",

      INSTNM == "Embry-Riddle Aeronautical University-Prescott" ~
        "Embry-Riddle Aeronautical University - Prescott",

      INSTNM == "South Dakota State University" ~
        "South Dakota State University",

      INSTNM == "St Catherine University" ~
        "St. Catherine University",

      INSTNM == "University of Missouri-Kansas City" ~
        "University of Missouri - Kansas City",

      INSTNM == "University of Missouri-St Louis" ~
        "University of Missouri - St. Louis",

      INSTNM == "University of Nebraska-Lincoln" ~
        "University of Nebraska - Lincoln",

      INSTNM == "University of Nevada-Reno" ~
        "University of Nevada - Reno",

      INSTNM == "University of New Hampshire-Main Campus" ~
        "University of New Hampshire",

      INSTNM == "University of Oklahoma-Norman Campus" ~
        "University of Oklahoma",

      INSTNM == "University of Pittsburgh-Pittsburgh Campus" ~
        "University of Pittsburgh",

      INSTNM == "University of South Carolina-Columbia" ~
        "University of South Carolina",

      INSTNM == "University of St Francis" ~
        "University of St. Francis - Illinois",

      UNITID == "174914" ~
        "University of St. Thomas - Minnesota",

      UNITID == "227863" ~
        "University of St. Thomas - Texas",

      INSTNM == "The University of Tennessee-Knoxville" ~
        "University of Tennessee",

      INSTNM == "The University of Tennessee-Martin" ~
        "University of Tennessee at Martin",

      INSTNM == "The University of Texas at Arlington" ~
        "University of Texas - Arlington",

      INSTNM == "The University of Texas at Dallas" ~
        "University of Texas - Dallas",

      INSTNM == "The University of Texas Permian Basin" ~
        "University of Texas - Permian Basin",

      INSTNM == "The University of Texas Rio Grande Valley" ~
        "University of Texas - Rio Grande Valley",

      INSTNM == "The University of Texas at Tyler" ~
        "University of Texas - Tyler",

      INSTNM == "University of Washington-Seattle Campus" ~
        "University of Washington",

      INSTNM == "University of Washington-Bothell Campus" ~
        "University of Washington - Bothell",

      INSTNM == "University of Washington-Tacoma Campus" ~
        "University of Washington - Tacoma",

      INSTNM == "The University of West Florida" ~
        "University of West Florida",

      INSTNM == "University of Wisconsin-Madison" ~
        "University of Wisconsin",

      INSTNM == "University of Wisconsin-La Crosse" ~
        "University of Wisconsin - La Crosse",

      INSTNM == "Virginia Polytechnic Institute and State University" ~
        "Virginia Tech",

      INSTNM == "West Texas A & M University" ~
        "West Texas A&M University",

      UNITID == "230807" ~
        "Westminster College - Utah",

      INSTNM == "Wheaton College" ~
        "Wheaton College - Illinois",

      INSTNM == "Wheaton College (Massachusetts)" ~
        "Wheaton College - Massachusetts",

      TRUE ~ INSTNM
    )
  )
```

```{r}
#| label: join-datasets

colleges <- niche_data_500 |>
  left_join(us_dep_of_ed, by = c("college" = "INSTNM")) |>
  filter(rank != 141) |>
  filter(rank != 181)
```

```{r}
#| label: select-variables

chosen_variables <- c(
  "college",
  "rank",
  "REGION",
  "ACCREDAGENCY",
  "CONTROL",
  "CCBASIC",
  "ADM_RATE",
  "UGDS",
  "UGDS_WHITE",
  "UGDS_BLACK",
  "UGDS_HISP",
  "UGDS_ASIAN",
  "UGDS_AIAN",
  "UGDS_NHPI",
  "UGDS_2MOR",
  "UGDS_NRA",
  "UGDS_UNKN",
  "NPT4_PUB",
  "NPT4_PRIV",
  "COSTT4_A",
  "COSTT4_P",
  "AVGFACSAL",
  "PCTPELL",
  "C150_4",
  "AGE_ENTRY",
  "FEMALE",
  "MARRIED",
  "FIRST_GEN",
  "FAMINC",
  "MD_FAMINC",
  "ENDOWBEGIN",
  "SAT_AVG",
  "ACTCMMID"
)

data <- colleges |>
  dplyr::select(chosen_variables)
```

3.  Some of the categorical variables in the US Department of Education dataset (`REGION`, `CONTROL`, and `CCBASIC`) used numbers to represent the different levels, so we looked at the data dictionary and replaced each number with the words that it represents.

```{r}
#| label: clean-categorical-variables

data <- data |>
  mutate(
    REGION = as.character(REGION),
    REGION = case_when(
      REGION == 1 ~ "New England",
      REGION == 2 ~ "Mid East",
      REGION == 3 ~ "Great Lakes",
      REGION == 4 ~ "Plains",
      REGION == 5 ~ "Southeast",
      REGION == 6 ~ "Southwest",
      REGION == 7 ~ "Rocky Mountains",
      REGION == 8 ~ "Far West",
      REGION == 9 ~ "Outlying Areas"
    ),
    CONTROL = as.character(CONTROL),
    CONTROL = case_when(
      CONTROL == 1 ~ "Public",
      CONTROL == 2 ~ "Private, Non-profit",
      CONTROL == 3 ~ "Private, For-profit"
    ),
    CCBASIC = as.character(CCBASIC),
    CCBASIC = case_when(
      CCBASIC == -2 ~ "Not applicable",
      CCBASIC == 0 ~ "Not classified",
      CCBASIC == 1 ~ "Associate's Colleges: High Transfer-High Traditional",
      CCBASIC == 2 ~ "Associate's Colleges: High Transfer-Mixed Traditional/Nontraditional",
      CCBASIC == 3 ~ "Associate's Colleges: High Transfer-High Nontraditional",
      CCBASIC == 4 ~ "Associate's Colleges: Mixed Transfer/Career & Technical-High Traditional",
      CCBASIC == 5 ~ "Associate's Colleges: Mixed Transfer/Career & Technical-Mixed Traditional/Nontraditional",
      CCBASIC == 6 ~ "Associate's Colleges: Mixed Transfer/Career & Technical-High Nontraditional",
      CCBASIC == 7 ~ "Associate's Colleges: High Career & Technical-High Traditional",
      CCBASIC == 8 ~ "Associate's Colleges: High Career & Technical-Mixed Traditional/Nontraditional",
      CCBASIC == 9 ~ "Associate's Colleges: High Career & Technical-High Nontraditional",
      CCBASIC == 10 ~ "Special Focus Two-Year: Health Professions",
      CCBASIC == 11 ~ "Special Focus Two-Year: Technical Professions",
      CCBASIC == 12 ~ "Special Focus Two-Year: Arts & Design",
      CCBASIC == 13 ~ "Special Focus Two-Year: Other Fields",
      CCBASIC == 14 ~ "Baccalaureate/Associate's Colleges: Associate's Dominant",
      CCBASIC == 15 ~ "Doctoral Universities: Very High Research Activity",
      CCBASIC == 16 ~ "Doctoral Universities: High Research Activity",
      CCBASIC == 17 ~ "Doctoral/Professional Universities",
      CCBASIC == 18 ~ "Master's Colleges & Universities: Larger Programs",
      CCBASIC == 19 ~ "Master's Colleges & Universities: Medium Programs",
      CCBASIC == 20 ~ "Master's Colleges & Universities: Small Programs",
      CCBASIC == 21 ~ "Baccalaureate Colleges: Arts & Sciences Focus",
      CCBASIC == 22 ~ "Baccalaureate Colleges: Diverse Fields",
      CCBASIC == 23 ~ "Baccalaureate/Associate's Colleges: Mixed Baccalaureate/Associate's",
      CCBASIC == 24 ~ "Special Focus Four-Year: Faith-Related Institutions",
      CCBASIC == 25 ~ "Special Focus Four-Year: Medical Schools & Centers",
      CCBASIC == 26 ~ "Special Focus Four-Year: Other Health Professions Schools",
      CCBASIC == 27 ~ "Special Focus Four-Year: Engineering Schools",
      CCBASIC == 28 ~ "Special Focus Four-Year: Other Technology-Related Schools",
      CCBASIC == 29 ~ "Special Focus Four-Year: Business & Management Schools",
      CCBASIC == 30 ~ "Special Focus Four-Year: Arts, Music & Design Schools",
      CCBASIC == 31 ~ "Special Focus Four-Year: Law Schools",
      CCBASIC == 32 ~ "Special Focus Four-Year: Other Special Focus Institutions",
      CCBASIC == 33 ~ "Tribal Colleges"
    )
  )
```

4.  All of the numerical variables are on different scales---for example, SAT scores can range from 400 to 1600, while admission rate can only range from 0 to 1---and so we standardized them for easier analysis and comparison. We created a scaled version of the dataset where the mean value of each numeric variable is 0, and the standard deviation 1. An example row of data is printed below.

```{r}
#| label: scale-numerical-variables

scaled_continuous_numeric_variables <- data |>
  select_if(is.numeric) |>
  dplyr::select(-rank) |>
  scale() |>
  data.frame()

other_variables <- data |>
  dplyr::select(rank | REGION | CONTROL | CCBASIC | !where(is.numeric))

scaled_data <- cbind(other_variables, scaled_continuous_numeric_variables) |>
  relocate(college)

scaled_data |>
  slice_head() |>
  knitr::kable()

```

## Exploratory Data Analysis

```{r}
#| label: exploration-by-rank-group

colleges_levels <- data |> 
  mutate(
    level = case_when(
      rank <= 100 ~ "1 to 100",
      rank > 100 & rank <= 200 ~ "101 to 200",
      rank > 200 & rank <= 300 ~ "201 to 300",
      rank > 300 & rank <= 400 ~ "301 to 400",
      rank > 400 & rank <= 500 ~ "401 to 500",
    ),
    .after = rank
  )

colleges_levels |> 
  group_by(level) |> 
  summarize(
    mean_ADM_Rate = mean(ADM_RATE, na.rm = TRUE),
    mean_SAT_AVG = mean(SAT_AVG, na.rm = TRUE),
    mean_ACTCMMID = mean(ACTCMMID, na.rm = TRUE),
    mean_UGDS_WHITE = mean(UGDS_WHITE, na.rm = TRUE),
    mean_UGDS_ASIAN = mean(UGDS_ASIAN, na.rm = TRUE),
    mean_COSTT4_A = mean(COSTT4_A, na.rm = TRUE)
  ) |> 
  rename(
    "Interval" = level,
    "Mean Admission Rate" = mean_ADM_Rate,
    "Mean SAT Average" = mean_SAT_AVG,
    "Mean ACT Median" =  mean_ACTCMMID,
    "Mean % White Students" = mean_UGDS_WHITE,
    "Mean % Asian Students" = mean_UGDS_ASIAN,
    "Mean Cost of Attendance" = mean_COSTT4_A
  ) |> 
  knitr::kable()
```

After grouping the schools into five groups of 100 by their rank, we see that different metrics vary considerably across the group. As the rank level gets higher, the mean admission rate increases, the mean SAT Average decreases, the mean ACT Median decreases, and the cost of attendance decreases. As far as demographic statistics, 1-100 ranked schools have considerably fewer White students and considerably more Asian students than schools ranked above 100. As the rank gets higher, the mean cost of attendance also tends to increases.

We also looked at means of rank by categorical variables, and seen that there does appear to be an association between them and rank, so we decided to include them all in our subsequent analysis. We have included our exploratory analysis in our appendix.

## Research Question and Hypothesis

**Question:** Which characteristics of a university are most associated with rankings on the Niche College Ranking list? Of these characteristics, what is the relationship between high and low rank?

**Hypothesis:** We hypothesize that SAT/ACT scores, acceptance rate, and family income will have the strongest association with rank because since Niche's audience is in large part students applying to college, we believe that they prioritize variables important in the college admissions process. Of these variables, we predict that SAT/ACT score will have strong negative relationship, acceptance rate will have a strong positive relationship, and family income will have a strong negative relationship with rank.

# Methodology

We have split the first part of our analysis into two approaches. The first approach consists of looking at he linear relationship between the numerical explanatory variables and college rank using R-squared variables. The second approach consists of building a stepwise regression model between many explanatory variables and college rank. As the variables that appear in the final model will be most important for determining rank, we will use the model results to corroborate our results from the first approach. As we cannot find an R-squared value or other numerical metric to measure a relationship involving a categorical variable, we decided to simply use the stepwise regression model to determine if there is a strong association between those variables and rank.

In the second part of our analysis, we will combine the results of the two approaches and characterize the relationship between rank and the variables with the strongest association with it.

## Approach #1: Individual Numerical Variable Analysis

First, we will create a linear regression models between each individual explanatory variable and college rank. Then, we will calculate the R-squared value for each respective model, rank the values from highest to lowest, and select the variables with the highest R-squared values.

## Approach #2: Stepwise Regression Modeling

A stepwise regression model can manage large amounts of potential predictor variables and fine-tune the model to choose the best predictor variables from the available options. In our case, we have more than 25 variables to be examined and thus it is crucial to have a automated workflow for model selections.

In our research, we will use both forward and backward selections in the stepwise regression model by utilizing MASS package. We will evaluate the performance of each iteration of the model based on Akaike information criterion (AIC). AIC is used to compare different possible models and determine which one is the best fit for the data in statistic practice.

There are two main steps in this approach.

1.  Create a correlation matrix to check correlation coefficients between variables so as to not use similar variables in our model. If two variables had an absolute value of r greater than 0.8, meaning they were too similar in how they factored into rankings, we only picked one of them to put into the model.
2.  Compute the stepwise regression model using MASS package and mainly `stepAIC()` functions for model selections based on AIC. For the initial setting of the linear regression model, we will import all the valid variables into the model to predict the rank variable.

In the end, this will give us the best final model with much fewer variables. Those variables are the most influential factors to the rank of the college.

## Final Variable Analysis

We will examine the final variables selected by both approaches and analyze their relationships with college rank by:

1.  Interpreting the R-squared values and graphs to characterize the linear association for each variable and rank.

2.  Calculate the linear regression slopes between each of the explanatory variables (scaled and non-scaled) and college rank. Then we will use the scaled slopes to determine which explanatory variable has the greatest influence on college on a school having a higher rank. We will interpret the relationships using the non-scaled slopes.

# Results

## Approach #1: Individual Numerical Variable Analysis

**Table of R-squared Values**

The table below gives the R-squared values from the linear regression models between each individual explanatory variable in our data set and colleges rank, arranged in descending order.

```{r}
#| label: find-r2

numerical_variables  <- c(
  "ADM_RATE",
  "UGDS",
  "UGDS_WHITE",
  "UGDS_BLACK",
  "UGDS_HISP",
  "UGDS_ASIAN",
  "UGDS_AIAN",
  "UGDS_NHPI",
  "UGDS_2MOR",
  "UGDS_NRA",
  "UGDS_UNKN",
  "NPT4_PUB",
  "NPT4_PRIV",
  "COSTT4_A",
  "COSTT4_P",
  "AVGFACSAL",
  "PCTPELL",
  "C150_4",
  "AGE_ENTRY",
  "FEMALE",
  "MARRIED",
  "FIRST_GEN",
  "FAMINC",
  "MD_FAMINC",
  "ENDOWBEGIN",
  "SAT_AVG",
  "ACTCMMID"
)

r2s <- numeric()

for(var in numerical_variables) {
  temp_df <- data |>
  dplyr::select(c(rank, var))
  
  model <- linear_reg() |>
    set_engine("lm") |>
    fit(rank ~ ., data = temp_df)
  
  r2 <- glance(model)$r.squared
  
  r2s <- c(r2s, r2)
}

r_squared_values <- tibble(
  variable = numerical_variables, 
  r_squared = r2s
  ) |> 
  filter(variable != "COSTT4_P")

r_squared_values |>
  arrange(desc(r_squared)) |>
  slice(1:6) |>
  knitr::kable()
```

`COSTT4_P` (Average cost of attendance for program-year institutions) has been removed because there are only two observations.

Average SAT (`SAT_AVG`), median ACT (`ACTCMMID`), graduation rate (`C150_4`), average faculty salary (`AVGFACSAL`), and admission rate (`ADM_RATE`), are the five variables with the strongest correlation to rank, based on their R-Squared values; therefore, they are the variables we will be examining later in our analysis. We chose five as a cutoff because there is a substantial difference between the R-squared value of these five and the next variable (`PCTPELL)`.

## Approach #2: Stepwise Regression Model

**Remove Highly Correlated Variables**

```{r}
#| label: correlation-matrix
#| output: false

data_for_corr <- scaled_data |>
  dplyr::select(is.numeric)

correlations = data_for_corr |>
  dplyr::select(-c("NPT4_PUB", "NPT4_PRIV", "COSTT4_P")) |>
    na.omit() |>
    cor() 

correlations |>
    corrplot(method="color")
```

Below is the correlation table that only displays variable pairs with correlation values greater than or equal to 0.8.

```{r}
#| label: display-correlation-pair-to-be-removed

correlations[correlations < 0.8 | correlations == 1] <- ""
```

| Variable Pairs with r \> 0.8 | Correlation Coefficients |
|------------------------------|--------------------------|
| C150_4, SAT_AVG              | 0.8389                   |
| C150_4, ACTCMMID             | 0.8494                   |
| AGE_ENTRY, MARRIED           | 0.9059                   |
| FAMINC, MD_FAMINC            | 0.9538                   |
| SAT_AVG, ACTCMMID            | 0.9756                   |

We will drop the variables `C150_4`, `MD_FAMINC`, `ACTCMMID`, `MARRIED` and preserve `SAT_AVG` and `FAMINC` to represent all other variables.

**Compute Stepwise Regression**

```{r}
#| label: stepwise-regression-model
#| fontsize: 2pt

stepwise_data <- scaled_data |>
  dplyr::select(c("rank", "REGION", "CONTROL", "CCBASIC", "ACCREDAGENCY", "ADM_RATE", "UGDS", "UGDS_WHITE", "UGDS_BLACK", "UGDS_HISP", "UGDS_ASIAN", "UGDS_AIAN", "UGDS_NHPI", "UGDS_2MOR", "UGDS_NRA", "UGDS_UNKN", "COSTT4_A", "AVGFACSAL", "PCTPELL", "AGE_ENTRY", "FAMINC", "ENDOWBEGIN", "SAT_AVG", "FEMALE", "FIRST_GEN"))

# Factorize variable
stepwise_data <- stepwise_data |>
  mutate(
    REGION = as.factor(REGION),
    CONTROL = as.factor(CONTROL),
    CCBASIC = as.factor(CCBASIC),
    ACCREDAGENCY = as.factor(ACCREDAGENCY)
    )
library(MASS)
stepwise_data = na.omit(stepwise_data)
# Fit the full model
full_model <- lm(rank ~ ., data = stepwise_data)
# Stepwise regression model
stepwise_model <- stepAIC(full_model, direction = "both", trace = FALSE)

# stepwise_model$anova
```

```{r}
#| label: visualize-stepwise-model
#| fig.height: 2.3
#| fig.width: 6

aic_value = stepwise_model$anova$AIC

variables = c("All", "-FAMINC", "-PCTPELL", "-ENDOWBEGIN", "-UGDS_NHPI", "-UGDS_AIAN", "-UGDS_NRA", "-UGDSHISP", "-UGDS_BLACK", "-UGDS_WHITE", "-FEMALE", "+UGDS_HISP")

aic_df = data.frame(aic_value, variables)

aic_df<- aic_df |>
  mutate(variables = as.factor(variables))

aic_df <- aic_df |>
  mutate(
    variables = fct_relevel(variables, levels = c("All", "-FAMINC", "-PCTPELL", "-ENDOWBEGIN", "-UGDS_NHPI", "-UGDS_AIAN", "-UGDS_NRA", "-UGDSHISP", "-UGDS_BLACK", "-UGDS_WHITE", "-FEMALE", "+UGDS_HISP"))
  )

aic_df |>
  ggplot(aes(x = variables, y = aic_value)) +
  geom_point() +
  geom_line(group = 1) + 
  scale_y_continuous(breaks = seq(3415, 3431, by = 2)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(
    title = "Variable selection process",
    x = "Selection step",
    y = "AIC"
  )
  
```

In the stepwise regression shown above, each step represents a new iteration of the model after a certain variable is taken out. For example, the first step represents the first iteration with all the variables. Then, the variable `FAMINC` was removed, leading to a decrease in AIC. Then, one-by-one, it removes `PCTPELL`, `ENDOWBEGIN`, each level of undergraduate ethnicities, and female student population to continue making the best model for our data. Finally, the re-addition of `UGDS_HISP` led to the final iteration our of model with just 16 variables. We can tell this is the best model because its AIC value is the lowest.

**Model Results**

    Final Model:
    rank ~ REGION + CONTROL + CCBASIC + ACCREDAGENCY + ADM_RATE + 
        UGDS + UGDS_ASIAN + UGDS_2MOR + UGDS_UNKN + COSTT4_A + AVGFACSAL + 
        AGE_ENTRY + SAT_AVG + FIRST_GEN + UGDS_HISP

The plot above visually displays the decreasing AIC value as variables get taken out and potentially re-added.

```{r}
#| label: r-squared-final-model

final_model_fit <- linear_reg() |>
  fit(rank ~ REGION + CONTROL + CCBASIC + ACCREDAGENCY + ADM_RATE + 
    UGDS + UGDS_ASIAN + UGDS_2MOR + UGDS_UNKN + COSTT4_A + AVGFACSAL + 
    AGE_ENTRY + SAT_AVG + FIRST_GEN + UGDS_HISP, data = scaled_data)

```

We can further tell that this is our best model because it has an r-squared coefficient of `r glance(final_model_fit)$r.squared`. The variables here can then be considered to be the variables that affect a college's ranking the most. Region (`REGION`) and type of school (`CONTROL`, `CCBASIC`) influence its ranking. There are certain qualities of its undergraduate population that are more statistically significant than others and were thus included in this model: overall undergraduate population, number of Asians, Hispanics, mixed students, and first-generation students, and average age when the undergraduated enrolled. Average SAT score was also significant enough to be include into the model, and `ACCREDAGENCY` and cost of attendance were also the final two variables considered significant enough for our best model.

## Final Variable Analysis

**Categorical Variable Analysis**

All four categorical variables appeared in the final model, and therefore we can assume that they have a significant association with rank.

```{r}
#| label: rank-vs-region
#| layout-nrow: 2
#| fig-height: 6

colleges_levels |>
  ggplot(aes(y = REGION, fill = fct_rev(level))) +
  geom_bar(position = "fill") +
  scale_fill_viridis_d(limits = c("1 to 100", "101 to 200", "201 to 300", "301 to 400", "401 to 500")) +
  labs(
    title = "Rank vs Geographic Region of the United States",
    x = "Proportion",
    y = "Region",
    fill = "Rank"
  )

colleges_levels |>
  ggplot(aes(y = str_wrap(ACCREDAGENCY, 30), fill = fct_rev(level))) +
  geom_bar(position = "fill") +
  scale_fill_viridis_d(limits = c("1 to 100", "101 to 200", "201 to 300", "301 to 400", "401 to 500")) +
  labs(
    title = "Rank vs Accreditation Agency",
    x = "Proportion",
    y = "Accreditation Agency",
    fill = "Rank"
  )

colleges_levels |>
  ggplot(aes(y = CONTROL, fill = fct_rev(level))) +
  geom_bar(position = "fill") +
  scale_fill_viridis_d(limits = c("1 to 100", "101 to 200", "201 to 300", "301 to 400", "401 to 500")) +
  labs(
    title = "Rank vs Control",
    x = "Proportion",
    y = "Control",
    fill = "Rank"
  )

colleges_levels |>
  ggplot(aes(y = str_wrap(CCBASIC, 30), fill = fct_rev(level))) +
  geom_bar(position = "fill") +
  scale_fill_viridis_d(limits = c("1 to 100", "101 to 200", "201 to 300", "301 to 400", "401 to 500")) +
  labs(
    title = "Rank vs Carnegie Classification",
    x = "Proportion",
    y = "Carnegie Classification (Basic)",
    fill = "Rank"
  )


```

The Geographic Region graph shows that New England has the highest proportion of top-100 schools, while the Plains has the lowest. Apart from the `New England` and `NA` bars, the differences in proportions of rank groups do not vary dramatically between bars. It is possible that the strength of the correlation between rank and region is driven in large part by the association New England has with schools with the lowest 100 ranks.

There does not appear to be a obvious pattern in the accreditation agency graph, which could be because some of the agencies corresponded to very few schools in the top 500. Additionally, as accreditation agency is often based on location, it reflects results similar to the region graph.

There are only 4 `Private, For-profit` schools in the top 500, and all of them are ranked between 301 and 400. The proportions of ranks between `Private, Non-profit` and `Public` are similar, although the first appears to have a larger proportion of `1-100` schools, and the latter a higher proportion of `401-500` schools.

There appear to be the greatest differences between bars of proportions of rank groups in the Carnegie Classification group, suggesting that this has the strongest association with rank. It appears that the lower the rank, the higher proportion of schools in `Doctoral Universities: Very High Research Activity` and `Baccalaureate Colleges: Arts & Sciences Focus`. However, the opposite appeared to be true for all other classifications with 3 or more rank categories. Like accreditation agencies, some classifications corresponded to very few schools in the top 500.

Qualitatively, it appears that region and Carnegie Classification have the clearest relationship with rank; however, the final model indicates that they all have an association with rank.

**Numerical Variable Analysis**

All of the variables with the top 5 R-squared values appeared in the final stepwise regression model except for `ACTCMMID` (median ACT score) and `C150_4` (graduation rate). These were not used in the model because both of them had a high correlation with `SAT_AVG` (average SAT). Because `SAT_AVG` ended up in the final model, we can reasonably assume that they also have a strong association with rank based on the model's selection process. Therefore, we conclude that `SAT_AVG`, `ACTCMMID`, `C150_4`, `AVGFACSAL`, and `ADM_RATE` have the strongest association with rank and we will characterize the relationship below.

**How do these 5 metrics influence Niche college rank?**

```{r}

#| label: numerical-graphs

a1 <- colleges |> 
  ggplot(aes(x = SAT_AVG, y = rank)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm") +
  scale_y_continuous(limits = c(0,500)) +
  labs(
    x = "Avg. SAT",
    y = "Rank"
  ) 

a2 <- colleges |> 
  ggplot(aes(x = ACTCMMID, y = rank)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm") +
  scale_y_continuous(limits = c(0,500)) +
  labs(
    x = "Med. ACT",
    y = "Rank"
  )

a3 <- colleges |> 
  ggplot(aes(x = C150_4, y = rank)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm") +
  scale_y_continuous(limits = c(0,500)) +
  labs(
    x = "Graduation Rate",
    y = "Rank"
  )

a4 <- colleges |> 
  ggplot(aes(x = AVGFACSAL, y = rank)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm") +
  scale_y_continuous(limits = c(0,500)) +
  labs(
    x = "Avg. Faculty Salary",
    y = "Rank"
  )

a5 <- colleges |> 
  ggplot(aes(x = ADM_RATE, y = rank)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm") +
  scale_y_continuous(limits = c(0,500)) +
  labs(
    x = "Admission Rate",
    y = "Rank"
  )


grid.arrange(a1, a2, a3, a4, a5, ncol = 2)
```

```{r}
#| output: false

#| label: numerical-slope-r2

linear_reg() |> fit(rank ~ SAT_AVG, data = scaled_data)
linear_reg() |> fit(rank ~ SAT_AVG, data = colleges)

linear_reg() |> fit(rank ~ ACTCMMID, data = scaled_data)
linear_reg() |> fit(rank ~ ACTCMMID, data = colleges)

linear_reg() |> fit(rank ~ C150_4, data = scaled_data)
linear_reg() |> fit(rank ~ C150_4, data = colleges)

linear_reg() |> fit(rank ~ AVGFACSAL, data = scaled_data)
linear_reg() |> fit(rank ~ AVGFACSAL, data = colleges)

linear_reg() |> fit(rank ~ ADM_RATE, data = scaled_data)
linear_reg() |> fit(rank ~ ADM_RATE, data = colleges)

linear_reg() |> fit(rank ~ PCTPELL, data = scaled_data)
linear_reg() |> fit(rank ~ PCTPELL, data = colleges)
```

**R-squared, scaled slope, and un-scaled slope for linear regression models between 6 metrics and Niche College Rank**

```{r}

#| label: r2-slopes-kable

r2_slopes <- r_squared_values |>
  arrange(desc(r_squared)) |> 
  slice_head(n = 6) |> 
  mutate(
    scaled_slope = c(-115.0, -112.9, -103.5, -98.89, 91.74, 71.75),
    slope = c(-0.9277, -30.04, -735.2, -0.0347, 387.02, 644.76)       
  ) |> 
  rename(
    "R-Squared" = r_squared,
    "Scaled Slope" = scaled_slope,
    "Non-scaled Slope" = slope
  ) |> 
  mutate(
    variable = case_when (
      variable == "SAT_AVG" ~ "Avg. SAT",
      variable == "ACTCMMID" ~ "Med. ACT",
      variable == "C150_4" ~ "Graduation Rate",
      variable == "AVGFACSAL" ~ "Avg. Faculty Salary",
      variable == "ADM_RATE" ~ "Admission Rate",
      variable == "PCTPELL" ~ "% Students with Pell Grants",
      TRUE ~ variable
    )
  )

r2_slopes |> knitr::kable()
```

**Analysis**

The clearest way to interpret these R-Squared values is the following: 63% of the variation in college rank can be explained by average SAT score. This same interpretation can be used for all of the variables.

Looking further at the relationships, there is a negative relationship between SAT/ACT/Graduation Rate/Faculty Salary and rank. This indicates that as the variables increase, the rank of the school decreases. There is a positive relationship between admission rate and rank, indicating that as this variable increases, the rank of a school increases.

Looking at the non-scaled slope allows us to interpret how much changes in the explanatory variable change rank. For example for ACT, we can say that on average, we can expect a 1-point increase in ACT score to drop the rank of a school by 30 places. For admission rate, since it is scaled from 0-1, we need to divide the slope by 100 to get an interpretable number. It indicates that a 1-point drop in admission rate will, on average, result in an estimated drop in rank of the school by 3.87 places.

Looking at the scaled slope allows us to tell which variables have the greatest "influence" on rank. In other words, which change in a numerical variable away from the mean has the greatest impact on decreasing a school's rank? An extremely interesting trend is that among the five most associated variables, schools that have a stronger R-squared also have a higher absolute value of scaled-slope, indicating that variables that have the strongest association to rank also have the greatest influence on decreasing rank. This is logical because Niche would likely tie their rankings to variables where there is the greatest differentiation between schools with higher and lower ranks. This is also concerning because if schools know which variables are most associated to rank and which ones have the greatest impact on decreasing it, it is fairly easy for them to know which variables to change if they wanted to manipulate the rankings.

# Discussion

Based on our analysis, `SAT_AVG`, `ACTCMMID`, `C150_4`, `AVGFACSAL`, and `ADM_RATE` are the numerical explanatory variables most associated with college ranking (as determined in our individual variable analysis and confirmed in our step-wise regression model). We hypothesized that SAT/ACT scores, acceptance rate, and family income would have the strongest association with rank, and our results mostly confirm this hypothesis. SAT/ACT/Acceptance Rate were among the most correlated variables, but family income was not in the top five, possibly because financial aid allows students from a variety of situations to attend universities.

These relationships indicate certain priorities in college rankings. As SAT and ACT scores are the most correlated variables and the acceptance rate is in the top five, it is clear that the rankings highly prioritize selectivity in college admissions. This is logical since the audience of the rankings is mostly prospective students who are applying to college. There are obvious concerns with this approach: does it cause colleges to prioritize improving admissions selectivity over their quality of education and student outcomes? The inclusion of graduation rate and faculty salary do tell slightly different stories. Graduation rate indicates a focus on the ability of a university to meet the needs of its students and give them the resources and support. Faculty salary, in a way, may indicate the quality of the faculty both in teaching and research.

However, the stepwise regression model indicated that the categorical variables `REGION`, `ACCREDAGENCY`, `CONTROL`, and `CCBASIC` were also important to calculating rank. None of these variables were in our hypothesis. It is important to consider that none of these variables change as easily or frequently from year-to-year as the five numerical variables listen above---therefore, while they may be important to rank, schools cannot easily use them to manipulate their rankings.

Additionally, there are some variables that appear in the final model that have a lower individual R-squared value than some that were taken out of the model. We believe that this is because the model selected variables based on AIC rather than R-squared values. Additionally, it examines the collective predictive power of the variables rather than simply the predictive ability of variables individually.

It is important to recognize the limitations of our analysis, which are as follows: We left the categorical variables out of the first approach because we do not know a way to analyze numerically each variable's individual relationship with rank. In doing so, we did not subject these variables to the same two-step confirmation process that we did the numerical values. Furthermore, we assumed that all variables had linear relationship with ranks so we could use linear regression modelling to analyze them, which is within the scope of this class. Additionally, our linear models assume that rank is continuos and goes on forever. We recognize that this is not the case, but since the rank values have meaning and we have not learned how to properly work with ranked data in this class, we decided to use the linear regression to model the relationship between rank and other variables. All of these issues could be resolved by learning and implementing more appropriate statistical methods.

Finally, we believe that future avenues for this project could include analyzing more ranking systems, such as those created by US News and Forbes, and potentially even comparing the systems. It would be useful if students could understand what each system values and use the one most in line with their priorities. Additionally, we would like to look at more than 500 universities, ideally above 1000, to see if our results stay the same in universities throughout the country, and perhaps even throughout the world.

{{< pagebreak >}}

# Appendix

## Exploratory Analysis: Means of Rank by Categorical Variables

Below, we group the schools by the different categorical variables in our analysis and then take the mean rank for each of those groups. For Carnegie classification, any classification with only one school was removed from the analysis.

```{r}

#| label: exploration-control-region

group_by_control <- data |> 
  group_by(CONTROL) |>
  summarize(
    mean_rank = mean(rank)
  ) |> 
  arrange(mean_rank)


p1 <- group_by_control |> 
  ggplot(aes(x = reorder(CONTROL, + mean_rank), y = mean_rank, fill = CONTROL)) + 
  geom_col() +
  theme(legend.position = "none") + 
  labs(
    x = "Control of School", 
    y = "Mean Rank",
    title = "Mean Rank by Control"
  )


group_by_region <- data |> 
  group_by(REGION) |> 
  summarize(
    mean_rank = mean(rank)
  ) |> 
  arrange(mean_rank)



p2 <- group_by_region |>
  drop_na(REGION) |> 
  ggplot(aes(x = reorder(REGION, + mean_rank), y  = mean_rank, fill = REGION)) + 
  geom_col() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(size = 7)
  ) + 
  labs(
    x = "REGION", 
    y = "Mean Rank",
    title = "Mean Rank by Region"
  )

grid.arrange(p1, p2)
```

```{r}

#| label: exploration-CCBASIC

group_by_CCBASIC <- data |> 
  group_by(CCBASIC) |> 
  summarize(
    mean_rank = mean(rank)
  ) |> 
  arrange(mean_rank)

group_by_CCBASIC |>
  drop_na(CCBASIC) |>
   filter(
    CCBASIC != "Special Focus Four-Year: Business & Management Schools" &
    CCBASIC != "Baccalaureate/Associate's Colleges: Mixed Baccalaureate/Associate's" &
    CCBASIC != "Special Focus Four-Year: Other Special Focus Institutions" &
    CCBASIC != "Special Focus Four-Year: Other Technology-Related Schools" &
    CCBASIC != "Tribal Colleges"
  ) |> 
  ggplot(aes(y = reorder(CCBASIC, + mean_rank), x = mean_rank, fill = CCBASIC)) + 
  geom_col() +
  theme(legend.position = "none") + 
  labs(
    y = "Carnegie Classification", 
    x = "Mean Rank",
    title = "Mean Rank by Carnegie \nClassification"
  )

```

We observe that private non-profit colleges have a higher mean rank than public colleges or private for-profit colleges.

As far as region, schools from New England have the highest mean rank, while schools from the Plains have the lowest mean rank.

Looking at the Carnegie Classification, Doctoral Universities: Very High Research Activity have the highest mean rank, followed by Special Focus Four-Year: Engineering Schools. Master's Colleges and Universities: Medium Programs have the lowest mean rank.

## Full R-square Value List

```{r}
#| label: r-square-value-list
r_squared_values |>
  arrange(desc(r_squared)) |>
  knitr::kable()
```

{{< pagebreak >}}

# References

-   Learned how to do for loops from TA Eli Gnesin

-   We used the `scale()` function found at https://www.statology.org/standardize-data-in-r/

-   https://www.niche.com/colleges/search/best-colleges/

-   https://collegescorecard.ed.gov/data/

-   https://www.youtube.com/watch?v=ejR8LnQziPY

-   https://stackoverflow.com/questions/57248708/stepwise-model-selection-in-an-r-tidyverse-workflow

-   https://stackoverflow.com/questions/53135404/filter-correlation-matrix-r

-   https://stackoverflow.com/questions/68093071/how-to-highlight-high-correlations-in-ggpairs-correlation-matrix

-   http://www.sthda.com/english/wiki/visualize-correlation-matrix-using-correlogram

-   https://www.tutorialspoint.com/how-to-deal-with-missing-values-to-calculate-correlation-matrix-in-r

-   https://www.displayr.com/how-to-create-a-correlation-matrix-in-r/

-   https://stats.stackexchange.com/questions/550537/how-to-get-r-squared-after-doing-stepwise-model-selection-in-regression-in-r

-   http://www.sthda.com/english/articles/37-model-selection-essentials-in-r/154-stepwise-regression-essentials-in-r/

-   https://www.researchgate.net/figure/R-2-and-RMSE-of-forward-stepwise-regression-models-vs-WHO-algorithm_tbl1_354396022

-   https://www.r-bloggers.com/2016/05/visualizing-bootrapped-stepwise-regression-in-r-using-plotly/
